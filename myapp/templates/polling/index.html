<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Polling</title>
        <link rel="stylesheet"
              href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
              integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
              crossorigin="anonymous"/>
        <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    </head>
    <body>
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <h4>Mohon Pengisian Terdampak Covid-19 Tahun 2020 s.d. 2022</h4>
                    <br>
                    <form action="" method="post">
                        {% csrf_token %}
                        <div class="form-group row">
                            <label for="nama" class="col-md-12 form-label">Nama Anda</label>
                            <input type="text"
                                   class="col-md-12 form-control"
                                   name="nama"
                                   id="nama"
                                   placeholder="nama anda">
                            <label for="tahun" class="col-md-12 form-label">Tahun Terdampak</label>
                            <select class="col-md-12 form-control" name="tahun" id="tahun">
                                <option selected>
                                    Pilih Tahunnya
                                </option>
                                <option value="2020">
                                    2020
                                </option>
                                <option value="2021">
                                    2021
                                </option>
                                <option value="2022">
                                    2022
                                </option>
                            </select>
                            <button class="btn btn-primary" type="submit">Kirim</button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <div>
                        <h4>Yang Terdampak Tahun 2020</h4>
                    </div>
                    <div>
                        <table id="table" class="table table-striped">
                            <thead class="text-white bg-primary">
                                <tr>
                                    <th scope="col">Nama</th>
                                    <th scope="col">Jumlah</th>
                                    <th scope="col">Delete Jika Salah</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for x in poling %}
                                    <tr>
                                        <td>{{ x.nama }}</td>
                                        <td>1</td>
                                        <td>
                                            <a class="btn btn-warning"
                                               href="{% url 'delete' x.id %}"
                                               onclick="return confirm('Apakah Anda yakin akan menghapus data ini?')">Remove</a>
                                        </td>
                                    </tr>
                                {% endfor %}
                                <tr>
                                    <td id="total">
                                        <b>Total</b>
                                    </td>
                                    {% for x in total %}
                                        <td id="total{{x}}">
                                            <b></b>
                                        </td>
                                    {% endfor %}
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="col-md-6">
                    <div>
                        <h4>Yang Terdampak Tahun 2021</h4>
                    </div>
                    <div>
                        <table id="table2" class="table table-striped">
                            <thead class="text-white bg-primary">
                                <tr>
                                    <th scope="col">Nama</th>
                                    <th scope="col">Jumlah</th>
                                    <th scope="col">Delete Jika Salah</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for x in poling2 %}
                                    <tr>
                                        <td>{{ x.nama }}</td>
                                        <td>1</td>
                                        <td>
                                            <a class="btn btn-warning"
                                               href="{% url 'delete' x.id %}"
                                               onclick="return confirm('Apakah Anda yakin akan menghapus data ini?')">Remove</a>
                                        </td>
                                    </tr>
                                {% endfor %}
                                <tr>
                                    <td id="total">
                                        <b>Total</b>
                                    </td>
                                    {% for x in total2 %}
                                        <td id="total{{x}}">
                                            <b></b>
                                        </td>
                                    {% endfor %}
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="col-md-6">
                    <div>
                        <h4>Yang Terdampak Tahun 2022</h4>
                    </div>
                    <div>
                        <table id="table3" class="table table-striped">
                            <thead class="text-white bg-primary">
                                <tr>
                                    <th scope="col">Nama</th>
                                    <th scope="col">Jumlah</th>
                                    <th scope="col">Delete Jika Salah</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for x in poling3 %}
                                    <tr>
                                        <td>{{ x.nama }}</td>
                                        <td>1</td>
                                        <td>
                                            <a class="btn btn-warning"
                                               href="{% url 'delete' x.id %}"
                                               onclick="return confirm('Apakah Anda yakin akan menghapus data ini?')">Remove</a>
                                        </td>
                                    </tr>
                                {% endfor %}
                                <tr>
                                    <td id="total">
                                        <b>Total</b>
                                    </td>
                                    {% for x in total3 %}
                                        <td id="total{{x}}">
                                            <b></b>
                                        </td>
                                    {% endfor %}
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="row">
                <h3>Total Terdampak Covid dari Tahun 2021 s.d. 2022</h3>
                <div class="col-md-12">
                    <canvas id="myChart" width="400" height="400"></canvas>
                </div>
            </div>
        </div>
        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    </body>
    <script>
        var table = document.getElementById("table");
        var nama = 0,
            tahun = 0;
        for (let i = 1; i < table.rows.length - 1; i++) {
            console.log(table.rows[i].cells[1].innerHTML); 
            nama += parseFloat(table.rows[i].cells[1].innerHTML); 
            nama = Math.round(nama); 
            // tahun += parseFloat(table.rows[i].cells[2].innerHTML);
            // tahun = Math.round(tahun);
        }
        var total = [nama, tahun];
        var total2 = ["nama", "tahun"];
        for (y in total2) {
            document.getElementById("total" + total2[y]).innerHTML =
                total[y];
            // console.log("total"+total2[y]);
        }

        //tahun 2021
        var table2 = document.getElementById("table2");
        var nama2 = 0,
            tahun2 = 0;
        for (let i = 1; i < table2.rows.length - 1; i++) {
            console.log(table2.rows[i].cells[1].innerHTML); 
            nama2 += parseFloat(table2.rows[i].cells[1].innerHTML); 
            nama2 = Math.round(nama2); 
            // tahun2 += parseFloat(table2.rows[i].cells[2].innerHTML);
            // tahun2 = Math.round(tahun2);
        }
        var total3 = [nama2, tahun2];
        var total4 = ["nama2", "tahun2"];
        for (y in total4) {
            document.getElementById("total" + total4[y]).innerHTML =
                total3[y];
            // console.log("total"+total2[y]);
        }

        //Tahun 2022
        var table3 = document.getElementById("table3");
        var nama3 = 0,
            tahun3 = 0;
        for (let i = 1; i < table3.rows.length - 1; i++) {
            console.log(table3.rows[i].cells[1].innerHTML); 
            nama3 += parseFloat(table3.rows[i].cells[1].innerHTML); 
            nama3 = Math.round(nama3); 
            // tahun3 += parseFloat(table3.rows[i].cells[2].innerHTML);
            // tahun3 = Math.round(tahun3);
        }
        var total5 = [nama3, tahun3];
        var total6 = ["nama3", "tahun3"];
        for (y in total6) {
            document.getElementById("total" + total6[y]).innerHTML =
                total5[y];
            // console.log("total"+total2[y]);
            
        }

        const total2020 = nama;
        const total2021 = nama2;
        const total2022 = nama3;
        console.log(nama,nama2,nama3);

        //script membuat chart
        const ctx = document.getElementById('myChart').getContext('2d');
        const myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['2020 :' + total2020 , '2021 :' + total2021 , '2022 :' + total2022 ],
                datasets: [{
                    label: 'Total Terdampak',
                    data: [total2020, total2021, total2022],
                    backgroundColor: [
                        'rgba(255, 99, 132, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)'
        
                    ],
                    borderColor: [
                        'rgba(255, 99, 132, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)'
        
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    </script>
</html>
